from pypdf import PdfReader
from sentence_transformers import SentenceTransformer
import chromadb

# --- Extract text from PDF ---
def extract_pdf_text(pdf_path):
    reader = PdfReader(pdf_path)
    text = ""
    for page in reader.pages:
        text += page.extract_text() + "\n"
    return text

# --- Chunk text ---
def chunk_text(text, size=200):
    words = text.split()
    return [" ".join(words[i:i+size]) for i in range(0, len(words), size)]

# Load your PDF (Word â†’ PDF saved)
pdf_text = extract_pdf_text("myfile.pdf")
chunks = chunk_text(pdf_text)

# Embedding model
model = SentenceTransformer("all-MiniLM-L6-v2")
embeddings = model.encode(chunks).tolist()

# ChromaDB
chroma_client = chromadb.PersistentClient(path="chroma_store")
collection = chroma_client.get_or_create_collection(name="my_document")

# Add PDF chunks
collection.add(
    ids=[str(i) for i in range(len(chunks))],
    documents=chunks,
    embeddings=embeddings
)

# Query
query = "birds"
query_embedding = model.encode([query]).tolist()

results = collection.query(
    query_embeddings=query_embedding,
    n_results=6
)

print("Query:", query)
print("Results:", results)
